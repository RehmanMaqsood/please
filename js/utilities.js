function forceNumber(input){return"number"==typeof input?input:("string"==typeof input&&(input=input.replace(/[^0-9\.]/g,"")),input||(input=0),parseFloat(input,10))}function formatNumber(input,options){if("N/A"==input||"string"==typeof input&&input.indexOf("<")>-1)return input;input=forceNumber(input);var finalNumber,suffix="";if(input>1e9)finalNumber=Number(input/1e9).toFixed(1),suffix="B";else if(input>1e6)finalNumber=Number(input/1e6).toFixed(1),suffix="M";else if(input>=1e4||options&&"smallest"===options.size&&input>=1e3){finalNumber=Number(input/1e3).toFixed(1),suffix="K",finalStr=String(finalNumber);var dot=finalStr.indexOf(".");if(dot>-1){var decimal=finalStr.substr(dot+1);"1"!==decimal[0]&&"9"!==decimal[0]||(finalNumber=Math.round(finalNumber))}}else if(input>=1e3)finalNumber=Math.round(input);else if(String(input).indexOf(".")>-1){var parts=String(input).split(".");parts[1][1]>5&&parts[1][0]++,finalNumber=parts[0]+"."+parts[1][0]}else finalNumber=input;var finalStr=String(finalNumber);return finalStr.match(/^[0-9]*\.[0-9]*0$/)&&(finalStr=finalStr.substr(0,finalStr.length-1),"."===finalStr[finalStr.length-1]&&(finalStr=finalStr.substr(0,finalStr.length-1))),""===suffix&&(finalStr=commaNumber(finalNumber)),finalStr+suffix}function passNote(data){top.postMessage(data,"*")}function log(){window.debug&&(console.log.apply(console,arguments),"true"===localStorage.trace&&console.trace())}function warn(){window.debug&&(console.warn.apply(console,arguments),"true"===localStorage.trace&&console.trace())}function formatCurrency(amount){return"$"+(amount>1e3?formatNumber(amount):amount.toFixed(2))}function calculateEstimatedEarnings(views){var CPM=1.5;return CPM*(views/1e3)}function commaNumber(input){return"string"==typeof input?input:(input=forceNumber(input),Number(input).toLocaleString("en"))}function calculatePercentage(num1,num2){num1||(num1=0),num2||(num2=0),num1=num1.toString().split(",").join(""),num2=num2.toString().split(",").join(""),num1=Math.abs(parseFloat(num1,10)),num2=Math.abs(parseFloat(num2,10));var p=(num1/num2*100).toFixed(1);return!isNaN(p)&&isFinite(p)||(p=null),isNaN(p)||null===p||"undefined"==typeof p?0:p}function colorInterpolate(score){if(!score||isNaN(score))return[0,0,0];var gradient=[[200,50,0],[230,190,0],[100,200,0]],max=100,interval=max/gradient.length,point=score/interval,index=Math.floor(point),ratio=point-index;index>0&&index--;for(var a=gradient[index],b=gradient[Math.min(index+1,gradient.length-1)],c=[],i=0;i<a.length;i++)c[i]=Math.round(a[i]+(b[i]-a[i])*ratio);return c}function runAtTimes(fn){for(var i=1;i<arguments.length;i++)setTimeout(fn,arguments[i])}function pageScope(fn,argument){var argument=JSON.stringify(argument);pageExec("("+fn.toString()+")("+argument+")")}function pageExec(code){var script2=document.createElement("script");script2.textContent="localStorage.inject_value = "+code+";",document.documentElement.appendChild(script2);var ret=localStorage.inject_value;return delete localStorage.inject_value,ret}function copyText(txt,callback){return window.isFirefox?_cb({msg:"copy",text:txt},function(data){callback&&callback()}):(chrome.extension.sendMessage({copy:txt}),void callback())}function copyTagsGeneral(tags,appendTo){copyText(tags,function(){log("Send copy message to background page");var copied=$("<div>",{"class":"copied"}).text("Tags Copied!").hide();appendTo&&appendTo.append(copied.fadeIn("slow")),setTimeout(function(){copied.fadeOut("slow"),setTimeout(function(){copied.remove()},1e3)},3e3)})}window.$&&($.jsonAjax=function(type,url,data){return $.ajax({url:url,type:type,data:JSON.stringify(data),contentType:"application/json"})},$.jsonPost=function(url,data){return $.jsonAjax("POST",url,data)},$.jsonPut=function(url,data){return $.jsonAjax("PUT",url,data)});var utilities={},u=utilities;window.EventTracking&&(utilities.track=EventTracking.track.bind(EventTracking),utilities.trackFacebookConversion=EventTracking.trackFacebookConversion.bind(EventTracking),utilities.trackTwitterConversion=EventTracking.trackTwitterConversion.bind(EventTracking)),utilities.trigger=function(){var args=_.toArray(arguments);return $(window).trigger(args.shift(),args)},utilities.handle=function(event,fn){return $(window).on(event,fn)},utilities.dryRun=function(){return location.href.match(/DRY_RUN/)},utilities.simulateRequest=function(){var dfd=new $.Deferred,delay=100*Math.round(11*Math.random()),successful=Math.random()>.2;return setTimeout(successful?dfd.resolve:dfd.reject,delay),log("utilities#simulateRequest > Simulating a %s async request with %dms delay",successful?"SUCCESSFUL":"FAILED",delay),dfd.promise()},utilities.searchTerm=function(){var match=window.location.href.match(/(search_query|q)=([^&]+)/);if(!match)return!1;match=match[2]||"";var hadplus=!!match.match(/\+/);return match=decodeURIComponent(match),hadplus&&(match=match.replace(/\+/g," ")),match},utilities.location=function(){var adapter={graph:"historical",twitterFeed:"tweets",trends:"trending"},adapted=adapter[localStorage.view];return this.searchTerm()?"search":adapted||localStorage.view},utilities.pruneUpgraded=function(){var value=localStorage.justUpgraded;return value&&delete localStorage.justUpgraded,value},utilities.safely=function(callback){try{return callback()}catch(e){log("safely caught error",e)}return null},utilities.keyMirror=function(array,prefix){return prefix=prefix?prefix+"_":"",_.object(_.map(array,function(c){return[c,prefix+c]}))},utilities.prettyRandomId=function(){return(+new Date+Math.floor(999999*Math.random())).toString(36)},utilities.truncate=function(string,length){return _.isString(string)||(string=""),_.isNumber(length)||(length=10),string.length>length?string.slice(0,length-3).trim()+"...":string},utilities.getVideoUrl=function(videoId,ssl){var protocol=ssl===!1?"http://":"https://";return protocol+"www.youtube.com/watch?v="+videoId},utilities.numbro=function(input,options){options||(options={});var result=numbro(input).format(options.format||"0.0a"),suffix="";if(options.thousands&&9999>input&&input>999){var tformat=_.isString(options.thousands)?options.thousands:"0,0";result=numbro(input).format(tformat)}return result.match(/[^0-9]$/)&&(suffix=result.slice(-1).toUpperCase(),result=result.slice(0,-1)),options.trim!==!1&&(result=result.replace(/(\.[0-9]*?)0*$/,"$1").replace(/\.$/,"")),options.separate?[result,suffix]:result+suffix},utilities.convertTimeToSeconds=function(timeStr){var time=timeStr.split(":"),seconds=0;return 3===time.length?seconds=60*+time[0]*60+60*+time[1]+ +time[2]:2===time.length?seconds=60*+time[0]+ +time[1]:1===time.length&&(seconds=+time[0]),seconds};var numberWithCommas=commaNumber;utilities.commaNumber=commaNumber;var idd=0;Function.prototype.multiCb=function(){var runCheck,count=0,already_ran=!1,callback=this,data={},object=(idd++,function(name){return clearTimeout(runCheck),count++,function(){count--,name&&(data[name]=arguments),0===count&&(clearTimeout(runCheck),runCheck=setTimeout(function(){already_ran||(already_ran=!0,callback(data))},100))}});return object.timeout=function(ms){setTimeout(function(){already_ran||(already_ran=!0,callback(data))},ms)},object};var htmlEncoder=function(){function resetCharacterEntities(){charToEntity={},entityToChar={},addCharacterEntities({"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'"})}function addCharacterEntities(newEntities){var key,echar,charKeys=[],entityKeys=[];for(key in newEntities)echar=newEntities[key],entityToChar[key]=echar,charToEntity[echar]=key,charKeys.push(echar),entityKeys.push(key);charToEntityRegex=new RegExp("("+charKeys.join("|")+")","g"),entityToCharRegex=new RegExp("("+entityKeys.join("|")+"|&#[0-9]{1,5};)","g")}function htmlEncode(value){var htmlEncodeReplaceFn=function(match,capture){return charToEntity[capture]};return value?String(value).replace(charToEntityRegex,htmlEncodeReplaceFn):value}function htmlDecode(value){var htmlDecodeReplaceFn=function(match,capture){return capture in entityToChar?entityToChar[capture]:String.fromCharCode(parseInt(capture.substr(2),10))};return value?String(value).replace(entityToCharRegex,htmlDecodeReplaceFn):value}var charToEntityRegex,entityToCharRegex,charToEntity,entityToChar;return resetCharacterEntities(),{htmlEncode:htmlEncode,htmlDecode:htmlDecode}}();utilities.mountComponent=function(options){if(options.component&&(options.selector||options.element)&&(!options.url||-1!==window.location.href.indexOf(options.url))){var id;window.location.href;try{var opts=_.extend({},options,{component:options.component.displayName}),string=JSON.stringify(opts),id=_.map(string,function(_char,index){return string.charCodeAt(index).toString(36)}).join("")}catch(e){warn("Could not construct unique id for options",options)}var alreadyMounted=function(){return id&&$('[data-mount-id="'+id+'"').length>0?(log("mountComponent() > Ignoring duplicate mount"),!0):!1};if(!alreadyMounted()){var mount=function(){var component=React.createElement(options.component,options.props||{}),$root=options.inline?$("<span/>"):$("<div/>");$root.attr("data-mount-id",id);var insertFn=options.insertFn;insertFn&&"function"==typeof $root[insertFn]||(insertFn="append"),$(this)[insertFn]($root),options.rootClass&&$root.addClass(options.rootClass),$root.length&&React.render(component,$root.get(0))},findMountPoints=function(){if(!alreadyMounted()){var $mountPoints=$(options.selector);$mountPoints.length>0?$mountPoints.each(mount):setTimeout(findMountPoints,1e3)}};return options.element?mount.apply(options.element):findMountPoints(),id}}},utilities.time2sec=function(time){return _.isString(time)?_.reduce(_.map(time.split(":").reverse(),function(num,i){return parseFloat(num,10)*Math.pow(60,i)}),function(a,b){return a+b},0):0},utilities.sec2time=function(sec){if(!_.isNumber(sec))return"00:00:00";var units=_.map(this.getUnits(sec,3,60),function(u){var str=u.toString();return 1===str.length?"0"+str:str});return units.join(":").replace(/00:00/g,"00").replace(/^00:(..:)/g,"$1")},utilities.sec2fancy=function(sec){if(!_.isNumber(sec)||0===sec)return"instantaneously";var names=["hour","minute","second"],all=_.compact(_.map(this.getUnits(sec,3,60),function(value,i){if(0!==value){var name=names[i],and=name===names[names.length-1]?"and ":"";return and+value+" "+name+(1===value?"":"s")}}));return 1===all.length?all[0].replace(/and /,""):all.length>2?all.join(", "):all.join(" ")},utilities.getUnits=function(number,columns,base){for(var units=[],i=columns-1;i>=0;i--){var divisor=Math.pow(base,i),result=number/divisor;result=i>0?Math.floor(result):Math.round(1e3*result)/1e3,units.push(result),number%=divisor}return units},utilities.indices2literals=function(indices,literals){return _.map(indices,function(i){return literals[i]})},utilities.getAuthToken=function(url,name){var dfd=new $.Deferred;url||(url=window.location.href),name||(name="auth_token");var regex=new RegExp("("+name+'|XSRF_TOKEN)[\'"]: ?"([^"]+)');return $.get(url).done(function(html){var match=html.match(regex);return match&&match[1]?dfd.resolve(match[2]):void dfd.reject("Could not find token")}).fail(function(xhr){dfd.reject("Could not request token ("+xhr.status+")")}),dfd.promise()},utilities.retry=function(fn,dfd,n){var max=3;_.isNumber(n)||(n=1),dfd||(dfd=new $.Deferred);var promise=fn();return promise&&promise.done?(promise.done(dfd.resolve).fail(function(){if(n>=max)return log("RETRY > Retrying "+max+" times failed"),dfd.reject.apply(dfd,arguments);var delay=1500*n;log("RETRY > Retrying, attempt #"+n+" in "+delay+"ms"),setTimeout(function(){utilities.retry(fn,dfd,n+1)},delay)}),dfd.promise()):void 0},utilities.validateUrl=function(url){return url.match(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/)},utilities.precision=function(number,digits){var pow=Math.pow(10,digits);return Math.floor(number*pow)/pow},window._&&(utilities._etas={},utilities.eta=_.throttle(function(startedAt,progress){if(progress>=1&&delete this._etas[startedAt.toString()],startedAt&&_.isNumber(progress)){var now=new Date,key=startedAt.toString();this._etas[key]||(this._etas[key]=[{ratio:0,progress:0,time:startedAt}]);var records=this._etas[key],last=records[0];records.unshift({ratio:(progress-last.progress)/Math.floor((now-last.time)/1e3),progress:progress,time:now}),isFinite(records[0].ratio)||(records[0].ratio=0),this._etas[key]=records;var sum=_.reduce(records,function(a,b){return a+b.ratio},0),avg=sum/records.length,value=(1-progress)/avg;return isFinite(value)?value:null}},1e3)),utilities.etaString=function(eta){if(eta){var str=moment().add(eta,"seconds").fromNow();return str.match(/ago/)&&(str="about "+str.replace(/ago/,"")),str.replace(/^in/,"about")+" remaining"}},utilities.plural=function(num,single,plural){return plural||(plural=single+"s"),1===num?single:plural},utilities.capitalize=function(string){return _.isString(string)?string[0].toUpperCase()+string.slice(1):void 0},utilities.string2regex=function(string,flags){var regex;if(string){string=string.match(/^\/.*\/$/)?string.slice(1,string.length-1):string.replace(/([\[\]\(\)\.\?\^\$\{\}\-\+\*])/g,"\\$1");try{regex=new RegExp(string,flags||"")}catch(e){}}return regex},utilities.stripHtml=function(string){return string.replace(/<br( \/)?>/g,"\n").replace(/<[^>]+>/g,"")},utilities.convertEntities=function(string){var map={gt:">"};return string.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);?/gi,function($0,$1){return"#"===$1[0]?String.fromCharCode("x"===$1[1].toLowerCase()?parseInt($1.substr(2),16):parseInt($1.substr(1),10)):map.hasOwnProperty($1)?map[$1]:$0})};